{"ast":null,"code":"import _regeneratorRuntime from\"/Users/zanemaomac/Desktop/CIS5570/project/project---design-hw1-team_offersoverflow/WEB_APP/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/zanemaomac/Desktop/CIS5570/project/project---design-hw1-team_offersoverflow/WEB_APP/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/zanemaomac/Desktop/CIS5570/project/project---design-hw1-team_offersoverflow/WEB_APP/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from'react';import'bootstrap/dist/css/bootstrap.min.css';import{CardFeedPage}from'../components/CardFeedPage';import Stack from'react-bootstrap/Stack';import{NavLink}from\"react-router-dom\";import{useSelector,useDispatch}from'react-redux';import ListGroup from'react-bootstrap/ListGroup';import{selectCurrentUser}from'./UserPage/currentUserSlice';import{getUsersAsList,getLastestPostOfAUser,getPost,getUser,getUserFollowingSuggestion,getTotalFollowingPosts}from\"../fetcher\";import Row from'react-bootstrap/Row';import Col from'react-bootstrap/Col';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function FeedPage(){var dispatch=useDispatch();// get followings of the current user\nvar stateCurrentUser=useSelector(selectCurrentUser);var followingsUsernames=stateCurrentUser.followings;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),feedPostOfUser=_useState2[0],setFeedPostOfUser=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),popularPostsNearby=_useState4[0],setPopularPostsNearby=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),editedAndRefreshCards=_useState6[0],setEditedAndRefreshCards=_useState6[1];//the value of this switch doesn't matter only the change matter for triggering useEffect\nvar _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),hearFromDeleteComment=_useState8[0],setHearFromDeleteComment=_useState8[1];//the request for refreshing comment list from PopUp window, trigger value doesnt matter\nvar _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),visibility=_useState10[0],setVisibility=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),postBeingEdited=_useState12[0],setPostBeingEdited=_useState12[1];var _useState13=useState([]),_useState14=_slicedToArray(_useState13,2),suggestions=_useState14[0],setSuggestions=_useState14[1];var _useState15=useState(0),_useState16=_slicedToArray(_useState15,2),numPosts=_useState16[0],setnumPosts=_useState16[1];useEffect(function(){getUserFollowingSuggestion(stateCurrentUser.username).then(function(value){setSuggestions(value);console.log(suggestions);});},[]);useEffect(function(){function fetchData(){return _fetchData.apply(this,arguments);}function _fetchData(){_fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var userObjects,userObjectsFiltered,followingsLatestPost,numPost;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return getUsersAsList(followingsUsernames);case 2:userObjects=_context2.sent;//remove user who has no post\nuserObjectsFiltered=userObjects.filter(function(object){return object.posts.length!==0;});// map the object to it's latest post\n_context2.next=6;return Promise.all(userObjectsFiltered.map(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(o){var postObject;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getLastestPostOfAUser(o.username);case 2:postObject=_context.sent;return _context.abrupt(\"return\",postObject);case 4:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}()));case 6:followingsLatestPost=_context2.sent;setFeedPostOfUser(followingsLatestPost);_context2.next=10;return getTotalFollowingPosts(followingsUsernames);case 10:numPost=_context2.sent;setnumPosts(numPost);// fetch popular post\n// get the popular post\ncase 12:case\"end\":return _context2.stop();}}},_callee2);}));return _fetchData.apply(this,arguments);}if(stateCurrentUser.username!=='NOT_A_USER'){try{fetchData();setInterval(function(){fetchData().then(console.log(numPosts));},5000);}catch(err){console.error(err);}}},[editedAndRefreshCards,hearFromDeleteComment,numPosts]);//adding empty dependency making sure useEffect only run once after each render\nvar cards=(feedPostOfUser.length===0?popularPostsNearby:feedPostOfUser).map(function(p){return/*#__PURE__*/_jsx(CardFeedPage,{post:p,username:stateCurrentUser.username,oldEditedAndRefreshCards:editedAndRefreshCards,allDisplayedPosts:feedPostOfUser,setEditedAndRefreshCards:setEditedAndRefreshCards,setCommentState:setFeedPostOfUser,setPostBeingEdited:setPostBeingEdited,setVisibility:setVisibility});});var userlist=suggestions.map(function(p){return/*#__PURE__*/_jsx(ListGroup.Item,{as:\"li\",children:/*#__PURE__*/_jsx(NavLink,{to:\"/user/\"+p,className:\"button_text\",children:p})});});return/*#__PURE__*/_jsx(\"div\",{className:\"background\",children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Col,{style:{paddingLeft:\"10%\"},children:[stateCurrentUser.username===\"NOT_A_USER\"&&/*#__PURE__*/_jsx(_Fragment,{children:\"Please log in to see the activity feed.\"}),/*#__PURE__*/_jsx(Stack,{gap:2,className:\"col-md-6 mx-auto\",children:cards})]}),/*#__PURE__*/_jsxs(Col,{style:{paddingLeft:\"20%\",paddingRight:\"10%\",paddingBottom:\"2rem\"},children:[/*#__PURE__*/_jsx(\"h4\",{style:{paddingBottom:\"2rem\"},children:\" Recommended Users to Follow \"}),/*#__PURE__*/_jsx(ListGroup,{as:\"ul\",defaultActiveKey:\"#link1\",children:userlist})]})]})});}","map":{"version":3,"names":["React","useState","useEffect","CardFeedPage","Stack","NavLink","useSelector","useDispatch","ListGroup","selectCurrentUser","getUsersAsList","getLastestPostOfAUser","getPost","getUser","getUserFollowingSuggestion","getTotalFollowingPosts","Row","Col","FeedPage","dispatch","stateCurrentUser","followingsUsernames","followings","feedPostOfUser","setFeedPostOfUser","popularPostsNearby","setPopularPostsNearby","editedAndRefreshCards","setEditedAndRefreshCards","hearFromDeleteComment","setHearFromDeleteComment","visibility","setVisibility","postBeingEdited","setPostBeingEdited","suggestions","setSuggestions","numPosts","setnumPosts","username","then","value","console","log","fetchData","userObjects","userObjectsFiltered","filter","object","posts","length","Promise","all","map","o","postObject","followingsLatestPost","numPost","setInterval","err","error","cards","p","userlist","paddingLeft","paddingRight","paddingBottom"],"sources":["/Users/zanemaomac/Desktop/CIS5570/project/project---design-hw1-team_offersoverflow/WEB_APP/frontend/src/pages/FeedPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport { CardFeedPage } from '../components/CardFeedPage';\nimport Stack from 'react-bootstrap/Stack';\nimport { NavLink } from \"react-router-dom\";\nimport { useSelector, useDispatch } from 'react-redux'\nimport ListGroup from 'react-bootstrap/ListGroup';\nimport { selectCurrentUser } from './UserPage/currentUserSlice'\nimport { getUsersAsList, getLastestPostOfAUser, getPost, getUser, getUserFollowingSuggestion, getTotalFollowingPosts } from \"../fetcher\";\nimport Row from 'react-bootstrap/Row';\nimport Col from 'react-bootstrap/Col';\n\nexport default function FeedPage() {\n  const dispatch = useDispatch();\n  // get followings of the current user\n  const stateCurrentUser = useSelector(selectCurrentUser);\n  let followingsUsernames = stateCurrentUser.followings;\n  const [feedPostOfUser, setFeedPostOfUser] = useState([]);\n  const [popularPostsNearby, setPopularPostsNearby] = useState([]);\n  const [editedAndRefreshCards, setEditedAndRefreshCards] = useState(true); //the value of this switch doesn't matter only the change matter for triggering useEffect\n  const [hearFromDeleteComment, setHearFromDeleteComment] = useState(false); //the request for refreshing comment list from PopUp window, trigger value doesnt matter\n  const [visibility, setVisibility] = useState(false);\n  const [postBeingEdited, setPostBeingEdited] = useState({});\n  const [suggestions, setSuggestions] = useState([]);\n  const [numPosts, setnumPosts] = useState(0);\n\n\n  useEffect(() => {\n    getUserFollowingSuggestion(stateCurrentUser.username).then(\n      value => {\n        setSuggestions(value);\n        console.log(suggestions)\n      });\n  }, []);\n\n  useEffect(() => {\n\n    async function fetchData() {\n      const userObjects = await getUsersAsList(followingsUsernames);\n\n      //remove user who has no post\n      const userObjectsFiltered = userObjects.filter((object) => {\n        return object.posts.length !== 0;\n      });\n\n      // map the object to it's latest post\n      const followingsLatestPost = await Promise.all(userObjectsFiltered.map(async (o) => {\n        //return the largest(most recent) ID\n        let postObject = await getLastestPostOfAUser(o.username);\n        return postObject;\n      }))\n\n      setFeedPostOfUser(followingsLatestPost);\n      const numPost = await getTotalFollowingPosts(followingsUsernames);\n      setnumPosts(numPost);\n      // fetch popular post\n      // get the popular post\n    }\n\n    if (stateCurrentUser.username !== 'NOT_A_USER') {\n      try {\n        fetchData();\n        setInterval(() => {\n          fetchData().then(\n            console.log(numPosts)\n          );\n        }, 5000);\n      }\n      catch (err) {\n        console.error(err);\n      }\n    }\n  }, [editedAndRefreshCards, hearFromDeleteComment, numPosts]); //adding empty dependency making sure useEffect only run once after each render\n\n\n  const cards = ((feedPostOfUser.length === 0) ? popularPostsNearby : feedPostOfUser).map((p) => (\n    <CardFeedPage post={p} username={stateCurrentUser.username} oldEditedAndRefreshCards={editedAndRefreshCards} allDisplayedPosts={feedPostOfUser}\n      setEditedAndRefreshCards={setEditedAndRefreshCards} setCommentState={setFeedPostOfUser}\n      setPostBeingEdited={setPostBeingEdited} setVisibility={setVisibility} />\n  ))\n\n  let userlist = suggestions.map((p) => (\n    <ListGroup.Item as=\"li\" >\n      <NavLink to={\"/user/\" + p} className=\"button_text\">\n        {p}\n      </NavLink>\n    </ListGroup.Item>\n  ))\n\n  return (\n    <div className='background'>\n\n      <Row>\n        <Col style={{ paddingLeft: \"10%\" }}>\n          {stateCurrentUser.username === \"NOT_A_USER\" && <>Please log in to see the activity feed.</>}\n          <Stack gap={2} className=\"col-md-6 mx-auto\">\n            {cards}\n          </Stack>\n        </Col>\n\n        <Col style={{ paddingLeft: \"20%\", paddingRight: \"10%\", paddingBottom: \"2rem\" }}>\n          <h4 style={{ paddingBottom: \"2rem\" }}> Recommended Users to Follow </h4>\n          <ListGroup as=\"ul\" defaultActiveKey=\"#link1\">\n            {userlist}\n          </ListGroup>\n        </Col>\n\n      </Row>\n\n    </div>\n  );\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}