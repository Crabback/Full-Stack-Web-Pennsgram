{"ast":null,"code":"import _regeneratorRuntime from\"/Users/zanemaomac/Desktop/CIS5570/project/project---design-hw1-team_offersoverflow/WEB_APP/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _toConsumableArray from\"/Users/zanemaomac/Desktop/CIS5570/project/project---design-hw1-team_offersoverflow/WEB_APP/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/Users/zanemaomac/Desktop/CIS5570/project/project---design-hw1-team_offersoverflow/WEB_APP/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/zanemaomac/Desktop/CIS5570/project/project---design-hw1-team_offersoverflow/WEB_APP/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import\"../Styles.css\";import React,{useState}from'react';import{Footer}from\"../components/Footer\";import{useNavigate}from\"react-router-dom\";import Button from'react-bootstrap/Button';import Form from'react-bootstrap/Form';import Row from'react-bootstrap/Row';import Col from'react-bootstrap/Col';import{updateCurrentUser,selectCurrentUser}from'./UserPage/currentUserSlice';import{useSelector,useDispatch}from'react-redux';import{getPosts,createNewPost}from\"../fetcher\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function UploadPostPage(){var navigate=useNavigate();var _useState=useState('https://drive.google.com/uc?export=view&id=1F2X0d6KkJWV26qoofFx6u9YGeUnCSfcl'),_useState2=_slicedToArray(_useState,2),media=_useState2[0],setMedia=_useState2[1];var stateCurrentUser=useSelector(selectCurrentUser);var dispatch=useDispatch();var handleImageURLInput=function handleImageURLInput(e){if(e.target.name===\"imageURL\"){setMedia(function(state){return e.target.value;});}};function handleChange(e){setMedia(URL.createObjectURL(e.target.files[0]));}function addDefaultImgSrc(ev){ev.target.src=\"https://st4.depositphotos.com/14953852/24787/v/600/depositphotos_247872612-stock-illustration-no-image-available-icon-vector.jpg\";setMedia(\"https://st4.depositphotos.com/14953852/24787/v/600/depositphotos_247872612-stock-illustration-no-image-available-icon-vector.jpg\");}//handle the temporary inputs in the post description \nvar _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),descInput=_useState4[0],setDescInput=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),privateSetting=_useState6[0],setprivateSettting=_useState6[1];var handleDescInput=function handleDescInput(e){setDescInput(e.target.value);};var handelPrivateSetting=function handelPrivateSetting(){setprivateSettting(!privateSetting);};//we only get 3 arguments of a post: \nvar handlePostUpload=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var newPost,prePosts,ids,maxID,newID,updatedUser;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();if(!(stateCurrentUser.username===\"NOT_A_USER\")){_context.next=6;break;}alert(\"Please sign up/login to your account in order to make a post.\");navigate(\"/\");_context.next=20;break;case 6://create a new post object\nnewPost={\"id\":-1,\"author\":stateCurrentUser.username,\"description\":descInput,\"date\":\"10/1/2022\",\"image\":media,\"likes\":[],\"comments\":[],\"private\":privateSetting};_context.next=9;return getPosts();case 9:prePosts=_context.sent;//update the id field\nids=prePosts.length===0?[0,-1]:prePosts.map(function(object){return object.id;});maxID=Math.max.apply(Math,_toConsumableArray(ids));newID=maxID+1;newPost.id=newID;//call api\n_context.next=16;return createNewPost(stateCurrentUser.username,newPost);case 16:updatedUser=_context.sent;//dispatch the updated user;\ndispatch(updateCurrentUser(updatedUser));console.log(\"upload completed\");navigate(\"/user/\"+stateCurrentUser.username);case 20:case\"end\":return _context.stop();}}},_callee);}));return function handlePostUpload(_x){return _ref.apply(this,arguments);};}();function MediaPreview(props){if(props.mediaLink.split(\".\").slice(-1)=='mp4'){return/*#__PURE__*/_jsx(Form.Group,{className:\"mb-3\",children:/*#__PURE__*/_jsx(\"video\",{width:\"500\",controls:true,children:/*#__PURE__*/_jsx(\"source\",{src:props.mediaLink,type:\"video/mp4\"})})});}else{return/*#__PURE__*/_jsx(Form.Group,{className:\"mb-3\",children:/*#__PURE__*/_jsx(\"img\",{onError:addDefaultImgSrc,src:props.mediaLink,alt:\"user pic 1\",width:\"400\",height:\"400\"})});}}return/*#__PURE__*/_jsxs(\"div\",{className:\"background\",children:[/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{}),/*#__PURE__*/_jsx(Form,{onSubmit:handlePostUpload,children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Col,{children:[/*#__PURE__*/_jsx(MediaPreview,{mediaLink:media}),/*#__PURE__*/_jsxs(Form.Group,{controlId:\"formFile\",className:\"mb-3\",style:{paddingRight:\"30%\"},children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Upload Media\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"file\",onChange:handleChange}),/*#__PURE__*/_jsx(Form.Control,{name:\"imageURL\",onChange:handleImageURLInput,placeholder:\"Enter online image url\"})]})]}),/*#__PURE__*/_jsxs(Col,{children:[/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",controlId:\"formBasicDescription\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Description\"}),/*#__PURE__*/_jsx(Form.Control,{as:\"textarea\",onChange:handleDescInput,placeholder:\"Description about the picture/video.\",rows:3})]}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",type:\"submit\",children:\"Upload\"}),/*#__PURE__*/_jsx(Form.Check,{style:{paddingTop:\"2rem\"},type:\"switch\",label:\"Private Post\",checked:privateSetting,onChange:handelPrivateSetting})]})]})}),/*#__PURE__*/_jsx(Col,{sm:1})]}),/*#__PURE__*/_jsx(\"div\",{style:{paddingLeft:\"2rem\",paddingTop:\"5rem\"},children:/*#__PURE__*/_jsx(Footer,{})})]});}export default UploadPostPage;","map":{"version":3,"names":["React","useState","Footer","useNavigate","Button","Form","Row","Col","updateCurrentUser","selectCurrentUser","useSelector","useDispatch","getPosts","createNewPost","UploadPostPage","navigate","media","setMedia","stateCurrentUser","dispatch","handleImageURLInput","e","target","name","state","value","handleChange","URL","createObjectURL","files","addDefaultImgSrc","ev","src","descInput","setDescInput","privateSetting","setprivateSettting","handleDescInput","handelPrivateSetting","handlePostUpload","preventDefault","username","alert","newPost","prePosts","ids","length","map","object","id","maxID","Math","max","newID","updatedUser","console","log","MediaPreview","props","mediaLink","split","slice","paddingRight","paddingTop","paddingLeft"],"sources":["/Users/zanemaomac/Desktop/CIS5570/project/project---design-hw1-team_offersoverflow/WEB_APP/frontend/src/pages/UploadPostPage.js"],"sourcesContent":["import \"../Styles.css\";\nimport React, { useState } from 'react';\nimport { Footer } from \"../components/Footer\";\nimport { useNavigate } from \"react-router-dom\";\nimport Button from 'react-bootstrap/Button';\nimport Form from 'react-bootstrap/Form';\nimport Row from 'react-bootstrap/Row';\nimport Col from 'react-bootstrap/Col';\nimport { updateCurrentUser, selectCurrentUser } from './UserPage/currentUserSlice'\nimport { useSelector, useDispatch } from 'react-redux'\nimport { getPosts, createNewPost } from \"../fetcher\";\n\nfunction UploadPostPage() {\n  const navigate = useNavigate();\n  const [media, setMedia] = useState('https://drive.google.com/uc?export=view&id=1F2X0d6KkJWV26qoofFx6u9YGeUnCSfcl');\n  const stateCurrentUser = useSelector(selectCurrentUser);\n  const dispatch = useDispatch();\n\n  const handleImageURLInput = (e) => {\n    if (e.target.name === \"imageURL\") {\n      setMedia((state) => (e.target.value));\n    }\n  }\n\n  function handleChange(e) {\n    setMedia(URL.createObjectURL(e.target.files[0]));\n  }\n\n  function addDefaultImgSrc(ev) {\n    ev.target.src = \"https://st4.depositphotos.com/14953852/24787/v/600/depositphotos_247872612-stock-illustration-no-image-available-icon-vector.jpg\";\n    setMedia(\"https://st4.depositphotos.com/14953852/24787/v/600/depositphotos_247872612-stock-illustration-no-image-available-icon-vector.jpg\");\n  }\n  //handle the temporary inputs in the post description \n  const [descInput, setDescInput] = useState(\"\");\n\n  const [privateSetting, setprivateSettting] = useState(false);\n\n  const handleDescInput = (e) => {\n    setDescInput(e.target.value);\n  };\n\n  const handelPrivateSetting = () => {\n    setprivateSettting(!privateSetting);\n  }\n\n  //we only get 3 arguments of a post: \n  const handlePostUpload = async (e) => {\n    e.preventDefault();\n\n    if (stateCurrentUser.username === \"NOT_A_USER\") {\n      alert(\"Please sign up/login to your account in order to make a post.\");\n      navigate(\"/\");\n    } else {\n      //create a new post object\n      const newPost = {\n        \"id\": -1,\n        \"author\": stateCurrentUser.username,\n        \"description\": descInput,\n        \"date\": \"10/1/2022\",\n        \"image\": media,\n        \"likes\": [],\n        \"comments\": [],\n        \"private\": privateSetting\n      }\n      const prePosts = await getPosts();\n      //update the id field\n      const ids = (prePosts.length === 0) ? [0, -1] : (prePosts.map(object => {\n        return object.id;\n      }));\n      const maxID = Math.max(...ids);\n      let newID = maxID + 1;\n      newPost.id = newID;\n\n      //call api\n      const updatedUser = await createNewPost(stateCurrentUser.username, newPost);\n      //dispatch the updated user;\n      dispatch(updateCurrentUser(updatedUser));\n      console.log(\"upload completed\");\n      navigate(\"/user/\" + stateCurrentUser.username);\n    }\n\n  }\n\n  function MediaPreview(props) {\n    if (props.mediaLink.split(\".\").slice(-1) == 'mp4') {\n      return (\n        <Form.Group className=\"mb-3\">\n          <video width=\"500\" controls >\n            <source src={props.mediaLink} type=\"video/mp4\" />\n          </video>\n        </Form.Group>\n      )\n    } else {\n      return (\n        <Form.Group className=\"mb-3\">\n          <img onError={addDefaultImgSrc} src={props.mediaLink} alt=\"user pic 1\" width=\"400\" height=\"400\"></img>\n        </Form.Group>\n      )\n    }\n\n  }\n\n  return (\n    <div className=\"background\">\n      <Row>\n        <Col ></Col>\n\n        <Form onSubmit={handlePostUpload}>\n          <Row>\n            <Col >\n              <MediaPreview mediaLink={media} />\n              <Form.Group controlId=\"formFile\" className=\"mb-3\" style={{ paddingRight: \"30%\" }}>\n                <Form.Label>Upload Media</Form.Label>\n                <Form.Control type=\"file\" onChange={handleChange} />\n                <Form.Control name=\"imageURL\" onChange={handleImageURLInput} placeholder=\"Enter online image url\" />\n              </Form.Group>\n            </Col>\n\n            <Col>\n              <Form.Group className=\"mb-3\" controlId=\"formBasicDescription\">\n                <Form.Label>Description</Form.Label>\n                <Form.Control as=\"textarea\" onChange={handleDescInput}\n                  placeholder=\"Description about the picture/video.\"\n                  rows={3} />\n              </Form.Group>\n\n              <Button variant=\"primary\" type=\"submit\">\n                Upload\n              </Button>\n\n              <Form.Check\n                style={{ paddingTop: \"2rem\" }}\n                type=\"switch\"\n                label=\"Private Post\"\n                checked={privateSetting}\n                onChange={handelPrivateSetting}\n              />\n            </Col>\n          </Row>\n        </Form>\n\n        <Col sm={1}></Col>\n      </Row>\n      <div style={{ paddingLeft: \"2rem\", paddingTop: \"5rem\" }}>\n        <Footer />\n      </div>\n    </div>)\n}\nexport default UploadPostPage"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}