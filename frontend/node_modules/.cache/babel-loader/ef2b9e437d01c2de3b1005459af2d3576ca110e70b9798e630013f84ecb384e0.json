{"ast":null,"code":"import _regeneratorRuntime from\"/Users/zanemaomac/Desktop/CIS5570/project/project---design-hw1-team_offersoverflow/WEB_APP/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/zanemaomac/Desktop/CIS5570/project/project---design-hw1-team_offersoverflow/WEB_APP/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/zanemaomac/Desktop/CIS5570/project/project---design-hw1-team_offersoverflow/WEB_APP/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React from'react';import{Footer}from\"../components/Footer\";import Button from'react-bootstrap/Button';import Form from'react-bootstrap/Form';import Container from'react-bootstrap/Container';import Row from'react-bootstrap/Row';import Col from'react-bootstrap/Col';import{getUser,login,lock}from\"../fetcher\";import{useState}from'react';import{Navigate}from\"react-router-dom\";import{useSelector,useDispatch}from'react-redux';import{updateCurrentUser,selectCurrentUser}from'./UserPage/currentUserSlice';//the compoent of a LoginForm which keep track of login username\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function LoginForm(props){var dispatch=useDispatch();//console.log(sessionStorage.removeItem('lock-token'));\n// local state\nvar stateCurrentUser=useSelector(selectCurrentUser);var _useState=useState({username:'',password:''}),_useState2=_slicedToArray(_useState,2),newInput=_useState2[0],setInput=_useState2[1];var _useState3=useState(1),_useState4=_slicedToArray(_useState3,2),fails=_useState4[0],setFails=_useState4[1];var handleOnChange=function handleOnChange(e){if(e.target.name===\"username\"){setInput(function(state){return{username:e.target.value,password:state.password};});}if(e.target.name==='password'){setInput(function(state){return{username:state.username,password:e.target.value};});}};//here login means fetch the user by username from the mock api\nvar handleLogin=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var results,user;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;_context.next=4;return login(newInput.username,newInput.password);case 4:results=_context.sent;if(results.data.data===null){alert(results.data.message);setFails(fails+1);}else{user=results.data.data;dispatch(updateCurrentUser(user));alert(\"Login Success! logged in as: \"+JSON.stringify(user.username));props.updateAuthen(sessionStorage.getItem('app-token')!==null);}_context.next=12;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);console.log(_context.t0);setFails(fails+1);case 12:console.log(fails);if(!(fails>=3)){_context.next=17;break;}_context.next=16;return lock(newInput.username);case 16:setFails(1);case 17:case\"end\":return _context.stop();}}},_callee,null,[[1,8]]);}));return function handleLogin(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(Form,{id:\"submitForm\",onSubmit:handleLogin,children:[/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",controlId:\"formBasicEmail\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Username\"}),/*#__PURE__*/_jsx(Form.Control,{name:\"username\",onChange:handleOnChange,placeholder:\"Enter username (eg. dog)\"})]}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-3\",controlId:\"formBasicPassword\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Password\"}),/*#__PURE__*/_jsx(Form.Control,{name:\"password\",type:\"password\",onChange:handleOnChange,placeholder:\"Password\"})]}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",type:\"submit\",children:\"Login\"})]});}//the largest scope state controling the routing \nfunction LoginPage(){var _useState5=useState(sessionStorage.getItem('app-token')!==null),_useState6=_slicedToArray(_useState5,2),authenticated=_useState6[0],setAuthen=_useState6[1];console.log(sessionStorage);if(!authenticated){return/*#__PURE__*/_jsxs(\"div\",{className:\"background\",children:[/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsx(Row,{md:true,children:/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(\"label\",{})})}),/*#__PURE__*/_jsxs(Row,{md:true,children:[/*#__PURE__*/_jsx(Col,{}),/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(LoginForm,{updateAuthen:setAuthen})}),/*#__PURE__*/_jsx(Col,{})]}),/*#__PURE__*/_jsx(Row,{ms:true})]}),/*#__PURE__*/_jsx(\"div\",{style:{paddingLeft:\"2rem\",paddingTop:\"5rem\"},children:/*#__PURE__*/_jsx(Footer,{})})]});}else{return/*#__PURE__*/_jsx(Navigate,{replace:true,to:'/feed'});}}export default LoginPage;","map":{"version":3,"names":["React","Footer","Button","Form","Container","Row","Col","getUser","login","lock","useState","Navigate","useSelector","useDispatch","updateCurrentUser","selectCurrentUser","LoginForm","props","dispatch","stateCurrentUser","username","password","newInput","setInput","fails","setFails","handleOnChange","e","target","name","state","value","handleLogin","preventDefault","results","data","alert","message","user","JSON","stringify","updateAuthen","sessionStorage","getItem","console","log","LoginPage","authenticated","setAuthen","paddingLeft","paddingTop"],"sources":["/Users/zanemaomac/Desktop/CIS5570/project/project---design-hw1-team_offersoverflow/WEB_APP/frontend/src/pages/LoginPage.js"],"sourcesContent":["import React from 'react';\nimport { Footer } from \"../components/Footer\";\nimport Button from 'react-bootstrap/Button';\nimport Form from 'react-bootstrap/Form';\nimport Container from 'react-bootstrap/Container';\nimport Row from 'react-bootstrap/Row';\nimport Col from 'react-bootstrap/Col';\nimport { getUser, login, lock } from \"../fetcher\";\nimport { useState } from 'react';\nimport { Navigate } from \"react-router-dom\";\nimport { useSelector, useDispatch } from 'react-redux'\nimport { updateCurrentUser, selectCurrentUser } from './UserPage/currentUserSlice'\n\n\n//the compoent of a LoginForm which keep track of login username\nfunction LoginForm(props) {\n\n  const dispatch = useDispatch();\n  //console.log(sessionStorage.removeItem('lock-token'));\n\n  // local state\n  const stateCurrentUser = useSelector(selectCurrentUser);\n  const [newInput, setInput] = useState({ username: '', password: '' });\n  const [fails, setFails] = useState(1);\n\n  const handleOnChange = (e) => {\n    if (e.target.name === \"username\") {\n      setInput((state) => ({\n        username: e.target.value,\n        password: state.password,\n      }));\n    }\n    if (e.target.name === 'password') {\n      setInput((state) => ({\n        username: state.username,\n        password: e.target.value,\n      }));\n    }\n  };\n\n  //here login means fetch the user by username from the mock api\n  const handleLogin = async (e) => {\n\n    e.preventDefault();\n\n    try {\n      const results = await login(newInput.username, newInput.password);\n      if (results.data.data === null) {\n        alert(results.data.message);\n        setFails(fails + 1);\n      } else {\n        let user = results.data.data\n        dispatch(updateCurrentUser(user));\n        alert(\"Login Success! logged in as: \" + JSON.stringify(user.username));\n        props.updateAuthen(sessionStorage.getItem('app-token') !== null);\n      }\n    } catch (err) {\n      console.log(err);\n      setFails(fails + 1);\n    }\n\n    console.log(fails);\n    if (fails >= 3) {\n      //lock the account\n      await lock(newInput.username);\n      setFails(1);\n    }\n  };\n\n\n  return (\n    <Form id=\"submitForm\" onSubmit={handleLogin}>\n      <Form.Group className=\"mb-3\" controlId=\"formBasicEmail\">\n        <Form.Label>Username</Form.Label>\n        <Form.Control name=\"username\" onChange={handleOnChange} placeholder=\"Enter username (eg. dog)\" />\n      </Form.Group>\n\n      <Form.Group className=\"mb-3\" controlId=\"formBasicPassword\">\n        <Form.Label>Password</Form.Label>\n        <Form.Control name=\"password\" type=\"password\" onChange={handleOnChange} placeholder=\"Password\" />\n      </Form.Group>\n      <Button variant=\"primary\" type=\"submit\">\n        Login\n      </Button>\n    </Form>\n  );\n}\n\n//the largest scope state controling the routing \n\n\nfunction LoginPage() {\n  const [authenticated, setAuthen] = useState(sessionStorage.getItem('app-token') !== null);\n  console.log(sessionStorage);\n\n  if (!authenticated) {\n    return (\n      <div className=\"background\">\n        <Container>\n          <Row md>\n\n            <Col><label></label></Col>\n          </Row>\n          <Row md>\n            <Col></Col>\n            <Col><LoginForm updateAuthen={setAuthen} /></Col>\n            <Col></Col>\n          </Row>\n          <Row ms>\n          </Row>\n        </Container>\n        <div style={{ paddingLeft: \"2rem\", paddingTop: \"5rem\" }}>\n          <Footer />\n        </div>\n      </div>\n    )\n  } else {\n    return <Navigate replace to={'/feed'} />;\n  }\n\n}\nexport default LoginPage"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}